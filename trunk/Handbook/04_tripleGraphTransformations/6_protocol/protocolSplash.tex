\newpage
\section{Extending the transformation}
\genHeader

% Remember, this is relevant for BOTH specifications.

% \emph{Introduce the problem: four partitions. Integrator doesn't help, what do? Protocol! Explain what went wrong, new rule! Run again, show protocol round
% two, and look! it runs fine.}

% Introduce problem: we want four partitions. Add one - woah, it doesn't work! Let's try the integrator. Doesn't help. Chat about the protocol. Lets implement a
% new rule!
% protocol Splash

% vis rule

% tex rule

% Run it again! It works! BRILLIANT. Show in protocol.

At this point, we now have a working TGG transformation for Dictionary into box with three partitions, and a box with \emph{precisely} three partitions into a
Dictionary. The only potential problem is that a learning box with only three partitions may not be the most useful studying too. After all, the more partitions
you have, the more practice you'll have with the cards by being quizzed again and again.

Let's try adding a fourth partition to \texttt{source.xmi} and run the TGG again. Given that we have a rule to transform three partitions, it should at least
complete a partial transformation, right? 

\begin{itemize}

\item[$\blacktriangleright$] Add a single \texttt{partition3} to your source, and run \texttt{TGGMain} again.

\item[$\blacktriangleright$] (What happened? It should have worked.) It worked, although .. Let's check out the integrator .. due to not setting the proper
references! Open \texttt{source.xmi} again and update \texttt{partition3.previous} to \texttt{partition0}, and \texttt{partition2.next} to \texttt{partition3}.
Add one more card until your source resembles Fig.~\ref{fig:fourthPartitionStart} and run the TGG once more.

\begin{figure}[htbp]
\begin{center}
  \includegraphics[width=0.7\textwidth]{eclipse_fillFourthPartition}
  \caption{caption}
  \label{fig:fourthPartitionStart}
\end{center}
\end{figure}

\item[$\blacktriangleright$] It didn't work! If you try to run the integrator, that won't work either.


\item[$\blacktriangleright$] Let's try inspecting the protocol file directly for more details. This will always be produced in \emph{every} transformation.
Therefore, if the integrator doesn't work, you will always have THIS file for reference.

\item[$\blacktriangleright$] Figure~\ref{fig:partition3comparison} to explain the look-ahead. (Let's compare the differences\ldots)

\newpage

\begin{figure}[htbp]
 	\centering
   \includegraphics[width=0.7\textwidth]{partition3_noConnections}
   \\ \vspace{1cm}
    \includegraphics[width=0.7\textwidth]{partition3_connections}
 	\caption{Successful and Unsuccessful TGG}
 	\label{fig:partition3comparison}
\end{figure}
\FloatBarrier

Even though there was a solution to the first threee, there was no way it could have connected number 4 successfully, resulting
in a dangling edge, which fujaba does not allow \ldots why didn't at least the first set of card from partitions 0, 1, 2. Work? Dangling edges - predicts that there
will be no way to repair it, so it ends te whole operation.

While we addressed in index issue in our implemenation code (anzthing above 2 would be assigned as index 2), that only took care of the attribute, not the
actual object. Lets consider just extending our current rule so it could handle a fourth card \ldots It would be as simple as including
another partition in our rule and connecting it proberly. But what if we wanted a fith? a sixth?  This obviously won't work -- there will always be an n+1
partition that needs to be resolved.

\item[$\blacktriangleright$] Let's extend our transformation by adding a third rule to take care of any situation where a \texttt{box} has more than three
partitions. Note that this rule won't just be checked whenever the first rule fails - it'll always be tested, but only executed if its the best match for the
situation (you may have to choose).

Therefore, the main goal of this rule will be to update the structure of a \texttt{box} during the forward transformation so that the \texttt{CardToEntry} rule
can be applied to any \texttt{card} found in a fourth, fifth, sixth, or greater \texttt{partition}. We therefore don't need to create any new \emph{correspondence
types}  as the changes will only affect the link variables and \texttt{index} attributes of a few \texttt{partition}s.

\end{itemize}

\jumpDual{allCards vis}{allCards tex}

\input{../6_protocol/visNewRule}

\input{../6_protocol/texNewRule}

\input{../6_protocol/protocolClose}
